## MODIFIED Requirements

### Requirement: 自定义Popup页面

扩展程序 SHALL 提供一个功能完整的自定义popup页面，作为用户访问扩展功能的主要入口，包含内置的模态编辑器功能。

#### Scenario: Popup页面功能展示

- **WHEN** 用户点击浏览器扩展图标
- **THEN** 显示包含以下功能的popup界面：
  - 文档库中的文档数量统计（可点击打开Side Panel）
  - 上次阅读文档记录（可点击跳转占位）
  - 抓取当前网页内容按钮（占位提示）
  - 手动输入Markdown内容按钮（打开内置编辑器）

### Requirement: 手动内容输入

Popup页面 SHALL 提供内置的模态编辑器，支持用户直接在popup内输入文档内容。

#### Scenario: 打开内置编辑器

- **WHEN** 用户点击"手动输入文档"按钮
- **THEN** popup界面切换到编辑器模式
- **AND** 编辑器覆盖整个popup区域
- **AND** 显示标题"📝 手动输入文档"
- **AND** 包含一个大的文本输入框用于内容输入

#### Scenario: 编辑器界面布局

- **WHEN** 编辑器模式激活时
- **THEN** 界面布局如下：
  - 顶部：标题栏
  - 中部：全宽文本输入框（支持多行输入）
  - 底部：左对齐的"取消"按钮，右对齐的"保存"按钮
- **AND** 所有控件适应320px popup宽度限制

### Requirement: 自动标题提取

Popup编辑器 SHALL 能够从用户输入的内容中自动提取文档标题。

#### Scenario: 标题提取逻辑

- **WHEN** 用户点击保存时
- **THEN** 系统按照以下优先级提取标题：
  1. 如果第一行以 `# ` 开头，去掉 `# ` 作为标题
  2. 如果第一行不是Markdown标题，取第一行前30个字符作为标题
  3. 如果内容为空，使用"无标题文档"作为默认标题

#### Scenario: 标题长度处理

- **WHEN** 提取的标题超过50个字符时
- **THEN** 自动截断并添加省略号
- **AND** 确保标题适合在文档库列表中显示

### Requirement: 保存和取消功能

Popup编辑器 SHALL 提供保存和取消两个操作按钮，支持用户完成或取消输入操作。

#### Scenario: 保存文档

- **WHEN** 用户点击"保存"按钮且内容不为空
- **THEN** 自动提取标题并保存到documentStorage
- **AND** 显示"跳转功能待实现"的Alert占位提示
- **AND** 关闭编辑器并返回主界面
- **AND** 新文档自动出现在Side Panel文档库中

#### Scenario: 取消操作

- **WHEN** 用户点击"取消"按钮
- **THEN** 直接关闭编辑器并返回主界面
- **AND** 不保存任何内容
- **AND** 清空编辑器中的临时内容

#### Scenario: 空内容验证

- **WHEN** 用户点击"保存"按钮但内容为空
- **THEN** 显示"请输入内容"的错误提示
- **AND** 保持编辑器打开状态
- **AND** 不执行保存操作

### Requirement: 界面状态管理

Popup组件 SHALL 提供流畅的界面切换体验，确保主界面和编辑器模式之间的无缝转换。

#### Scenario: 状态切换

- **WHEN** 用户点击"手动输入"按钮时
- **THEN** 主界面平滑过渡到编辑器界面
- **AND** 编辑器获得焦点，用户可以立即开始输入
- **WHEN** 用户完成操作（保存/取消）时
- **THEN** 编辑器界面平滑过渡回主界面

#### Scenario: 文本框优化

- **WHEN** 文本内容较多时
- **THEN** 文本框自动调整高度适应内容
- **AND** 保持popup总高度不超过浏览器限制
- **AND** 支持滚动条查看长内容